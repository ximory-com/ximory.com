<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心沐智康 - AI赋能健康科技 | Ximory Technology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .hero-logo { height: 128px; }
        .nav-logo { height: 48px; }
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #f5f5f5 50%, #e8f5e8 100%); }
        .health-assessment { display: none; }
        .health-assessment.active { display: block; }
        .health-dashboard { display: none; }
        .health-dashboard.active { display: block; }
        .progress-bar { transition: width 0.3s ease; }
        .score-bar { transition: width 1s ease; }
        .page-section { display: none; }
        .page-section.active { display: block; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- 导航栏 -->
    <nav class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- LOGO -->
                <div class="flex items-center">
                    <div class="text-2xl font-bold text-blue-600">心沐智康</div>
                </div>
                
                <!-- 桌面端导航菜单 -->
                <div class="hidden md:flex space-x-8">
                    <a href="#" onclick="showPage('home')" class="text-gray-700 hover:text-blue-600 font-medium">首页</a>
                    <a href="#about" onclick="scrollToSection('about')" class="text-gray-700 hover:text-blue-600 font-medium">关于我们</a>
                    <a href="#services" onclick="scrollToSection('services')" class="text-gray-700 hover:text-blue-600 font-medium">产品与服务</a>
                    <a href="#solutions" onclick="scrollToSection('solutions')" class="text-gray-700 hover:text-blue-600 font-medium">解决方案</a>
                    <a href="#" onclick="showPage('health-assessment')" class="text-gray-700 hover:text-blue-600 font-medium">健康评估</a>
                    <a href="#contact" onclick="scrollToSection('contact')" class="text-gray-700 hover:text-blue-600 font-medium">联系我们</a>
                    <a href="#" onclick="showPage('health-dashboard')" class="text-gray-700 hover:text-blue-600 font-medium">数据仪表板</a>
                </div>
                
                <!-- 语言切换和移动端菜单 -->
                <div class="flex items-center space-x-4">
                    <button onclick="toggleLanguage()" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-200">
                        <span id="lang-btn">EN</span>
                    </button>
                    <button onclick="toggleMobileMenu()" class="md:hidden p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- 移动端菜单 -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <div class="flex flex-col space-y-2">
                    <a href="#" onclick="showPage('home')" class="text-gray-700 hover:text-blue-600 font-medium py-2">首页</a>
                    <a href="#about" onclick="scrollToSection('about')" class="text-gray-700 hover:text-blue-600 font-medium py-2">关于我们</a>
                    <a href="#services" onclick="scrollToSection('services')" class="text-gray-700 hover:text-blue-600 font-medium py-2">产品与服务</a>
                    <a href="#solutions" onclick="scrollToSection('solutions')" class="text-gray-700 hover:text-blue-600 font-medium py-2">解决方案</a>
                    <a href="#" onclick="showPage('health-assessment')" class="text-gray-700 hover:text-blue-600 font-medium py-2">健康评估</a>
                    <a href="#contact" onclick="scrollToSection('contact')" class="text-gray-700 hover:text-blue-600 font-medium py-2">联系我们</a>
                    <a href="#" onclick="showPage('health-dashboard')" class="text-gray-700 hover:text-blue-600 font-medium py-2">数据仪表板</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主页内容 -->
    <div id="home" class="page-section active">
        <!-- Hero Section -->
        <section class="py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="mb-8">
                    <div class="hero-logo mx-auto mb-8 w-32 h-32 bg-blue-100 rounded-full flex items-center justify-center">
                        <div class="text-4xl font-bold text-blue-600">心沐</div>
                    </div>
                </div>
                <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
                    <span id="hero-title">用智慧赋能健康<br>让心灵沐浴科技之光</span>
                </h1>
                <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
                    <span id="hero-subtitle">AI 赋能 · 数字健康 · 人本关怀</span>
                </p>
                <p class="text-lg text-gray-500 mb-12 max-w-4xl mx-auto">
                    <span id="hero-description">心沐智康致力于以AI赋能个体健康管理，打造以用户为中心的数字健康解决方案</span>
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="showPage('health-assessment')" class="w-full sm:w-auto bg-gradient-to-r from-blue-600 to-green-600 text-white px-8 py-3 rounded-lg font-medium hover:from-blue-700 hover:to-green-700 transition-all">
                        <span id="assessment-btn">免费健康评估</span>
                    </button>
                    <button onclick="scrollToSection('about')" class="w-full sm:w-auto border-2 border-blue-600 text-blue-600 px-8 py-3 rounded-lg font-medium hover:bg-blue-600 hover:text-white transition-all">
                        <span id="learn-more-btn">了解更多</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- 关于我们 -->
        <section id="about" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">关于我们</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-6">品牌愿景</h3>
                        <p class="text-gray-600 mb-6">
                            让智慧与心灵共生，赋能每一个生命真实成长。我们相信健康不仅是身体无恙，更是身心灵的和谐共鸣。
                        </p>
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-4 mt-1">
                                    <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900">AI赋能健康管理</h4>
                                    <p class="text-gray-600">运用先进AI技术，提供个性化健康解决方案</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-4 mt-1">
                                    <div class="w-2 h-2 bg-green-600 rounded-full"></div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900">数字化健康生态</h4>
                                    <p class="text-gray-600">构建完整的数字健康管理生态系统</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-green-50 p-8 rounded-2xl">
                        <div class="text-center">
                            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-6">
                                <div class="text-2xl">🧠</div>
                            </div>
                            <h4 class="text-xl font-semibold text-gray-900 mb-4">智能健康评估</h4>
                            <p class="text-gray-600">基于AI算法的综合健康评估系统，为您提供专业的健康指导建议</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 联系我们 -->
        <section id="contact" class="py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">联系我们</h2>
                    <p class="text-xl text-gray-600">让我们一起构建更健康的未来</p>
                </div>
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <div class="space-y-6">
                            <div class="text-center">
                                <h3 class="text-xl font-semibold text-gray-900 mb-4">联系信息</h3>
                                <div class="space-y-3">
                                    <p class="text-gray-600">
                                        <strong>邮箱：</strong> contact@ximory.com
                                    </p>
                                    <p class="text-gray-600">
                                        <strong>网站：</strong> www.ximory.com
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 健康评估页面 -->
    <div id="health-assessment" class="page-section min-h-screen py-8">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">AI健康评估</h1>
                    <p class="text-gray-600">通过科学的评估方法，了解您的健康状况</p>
                </div>

                <!-- 进度条 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">评估进度</span>
                        <span class="text-sm font-medium text-gray-700" id="progress-text">第1步，共3步</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-600 to-green-600 h-2 rounded-full progress-bar" style="width: 33%"></div>
                    </div>
                </div>

                <!-- 步骤1：基本信息 -->
                <div id="step-1" class="step-content">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">基本信息</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">年龄</label>
                            <input type="number" id="age" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入年龄" min="1" max="120">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">性别</label>
                            <select id="gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">请选择性别</option>
                                <option value="male">男</option>
                                <option value="female">女</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">身高 (cm)</label>
                            <input type="number" id="height" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入身高" min="100" max="250">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">体重 (kg)</label>
                            <input type="number" id="weight" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入体重" min="30" max="300">
                        </div>
                    </div>
                    <div class="flex justify-end mt-8">
                        <button onclick="nextStep()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">下一步</button>
                    </div>
                </div>

                <!-- 步骤2：生活习惯 -->
                <div id="step-2" class="step-content" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">生活习惯</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">运动频率</label>
                            <select id="exercise" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">请选择运动频率</option>
                                <option value="never">从不运动</option>
                                <option value="rarely">偶尔运动</option>
                                <option value="sometimes">每周2-3次</option>
                                <option value="regularly">每天运动</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">睡眠质量</label>
                            <select id="sleep" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">请选择睡眠质量</option>
                                <option value="poor">较差</option>
                                <option value="fair">一般</option>
                                <option value="good">良好</option>
                                <option value="excellent">优秀</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">是否吸烟</label>
                            <select id="smoking" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">请选择</option>
                                <option value="no">否</option>
                                <option value="yes">是</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">饮酒频率</label>
                            <select id="alcohol" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">请选择饮酒频率</option>
                                <option value="never">从不饮酒</option>
                                <option value="occasionally">偶尔饮酒</option>
                                <option value="weekly">每周饮酒</option>
                                <option value="daily">每天饮酒</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-between mt-8">
                        <button onclick="prevStep()" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors">上一步</button>
                        <button onclick="submitAssessment()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors">获取结果</button>
                    </div>
                </div>

                <!-- 步骤3：评估结果 -->
                <div id="step-3" class="step-content" style="display: none;">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">评估结果</h2>
                    <div class="text-center mb-8">
                        <div class="text-6xl font-bold text-blue-600 mb-4" id="health-score">85</div>
                        <div class="text-2xl font-semibold mb-4" id="score-level">健康状况良好</div>
                        <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                            <div id="score-bar" class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full score-bar" style="width: 85%"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">健康建议</h3>
                            <div id="recommendations" class="space-y-3">
                                <!-- 建议内容将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center mt-8">
                        <button onclick="resetAssessment()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">重新评估</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 数据仪表板页面 -->
    <div id="health-dashboard" class="page-section min-h-screen py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-4">健康数据仪表板</h1>
                <div class="flex justify-between items-center">
                    <p class="text-gray-600">查看健康评估的统计数据和趋势分析</p>
                    <button onclick="refreshDashboard()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">刷新数据</button>
                </div>
            </div>

            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <div class="w-6 h-6 text-blue-600">📊</div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">总评估次数</p>
                            <p class="text-2xl font-semibold text-gray-900" id="total-assessments">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <div class="w-6 h-6 text-green-600">💚</div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">平均健康评分</p>
                            <p class="text-2xl font-semibold text-gray-900" id="average-score">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-yellow-100 rounded-lg">
                            <div class="w-6 h-6 text-yellow-600">📅</div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">今日评估</p>
                            <p class="text-2xl font-semibold text-gray-900" id="today-assessments">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-purple-100 rounded-lg">
                            <div class="w-6 h-6 text-purple-600">⭐</div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">优秀评分比例</p>
                            <p class="text-2xl font-semibold text-gray-900" id="excellent-percentage">0%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图表区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">健康评分分布</h3>
                    <div class="h-64">
                        <canvas id="score-chart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">年龄分布</h3>
                    <div class="h-64">
                        <canvas id="age-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 评估记录表格 -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">最近评估记录</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">评估时间</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">年龄</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">性别</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">BMI</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">健康评分</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">风险等级</th>
                            </tr>
                        </thead>
                        <tbody id="assessment-table" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-500">暂无评估记录</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentStep = 1;
        let isEnglish = false;
        let healthData = {};
        let currentPage = 'home';

        // 本地存储管理
        class HealthDataManager {
            constructor() {
                this.storageKey = 'ximory-health-assessments';
                this.assessments = this.loadAssessments();
            }

            loadAssessments() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('加载评估数据失败:', error);
                    return [];
                }
            }

            saveAssessments() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.assessments));
                } catch (error) {
                    console.error('保存评估数据失败:', error);
                }
            }

            addAssessment(assessmentData) {
                const assessment = {
                    id: Date.now(),
                    created_at: new Date().toISOString(),
                    basic_info: assessmentData.basicInfo,
                    lifestyle: assessmentData.lifestyle,
                    results: assessmentData.results
                };
                
                this.assessments.unshift(assessment);
                this.saveAssessments();
                return assessment;
            }

            getStatistics() {
                const total = this.assessments.length;
                if (total === 0) {
                    return {
                        total_assessments: 0,
                        average_score: 0,
                        today_stats: {
                            total_assessments: 0,
                            score_distribution: { excellent: 0, good: 0, fair: 0, poor: 0 },
                            age_distribution: { under_30: 0, age_30_50: 0, over_50: 0 }
                        }
                    };
                }

                // 计算平均分
                const totalScore = this.assessments.reduce((sum, a) => sum + a.results.health_score, 0);
                const averageScore = Math.round(totalScore / total * 10) / 10;

                // 今日统计
                const today = new Date().toDateString();
                const todayAssessments = this.assessments.filter(a => 
                    new Date(a.created_at).toDateString() === today
                );

                // 评分分布
                const scoreDistribution = { excellent: 0, good: 0, fair: 0, poor: 0 };
                this.assessments.forEach(a => {
                    const score = a.results.health_score;
                    if (score >= 80) scoreDistribution.excellent++;
                    else if (score >= 60) scoreDistribution.good++;
                    else if (score >= 40) scoreDistribution.fair++;
                    else scoreDistribution.poor++;
                });

                // 年龄分布
                const ageDistribution = { under_30: 0, age_30_50: 0, over_50: 0 };
                this.assessments.forEach(a => {
                    const age = a.basic_info.age;
                    if (age < 30) ageDistribution.under_30++;
                    else if (age <= 50) ageDistribution.age_30_50++;
                    else ageDistribution.over_50++;
                });

                return {
                    total_assessments: total,
                    average_score: averageScore,
                    today_stats: {
                        total_assessments: todayAssessments.length,
                        score_distribution: scoreDistribution,
                        age_distribution: ageDistribution
                    }
                };
            }

            getRecentAssessments(limit = 10) {
                return this.assessments.slice(0, limit);
            }
        }

        // 初始化数据管理器
        const healthDataManager = new HealthDataManager();

        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，初始化JavaScript功能');
            showPage('home');
        });

        // 页面切换函数
        function showPage(pageId) {
            // 隐藏所有页面
            const pages = document.querySelectorAll('.page-section');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // 显示指定页面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageId;

                // 如果是数据仪表板页面，刷新数据
                if (pageId === 'health-dashboard') {
                    setTimeout(() => refreshDashboard(), 100);
                }

                // 如果是健康评估页面，重置状态
                if (pageId === 'health-assessment') {
                    resetAssessment();
                }
            }

            // 关闭移动端菜单
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu) {
                mobileMenu.classList.add('hidden');
            }
        }

        // 移动端菜单切换
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu) {
                mobileMenu.classList.toggle('hidden');
            }
        }

        // 平滑滚动
        function scrollToSection(sectionId) {
            // 先切换到首页
            showPage('home');
            
            // 等待页面切换完成后滚动
            setTimeout(() => {
                const element = document.getElementById(sectionId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // 语言切换
        function toggleLanguage() {
            isEnglish = !isEnglish;
            updateLanguage();
        }

        function updateLanguage() {
            const langBtn = document.getElementById('lang-btn');
            if (langBtn) {
                langBtn.textContent = isEnglish ? '中' : 'EN';
            }

            // 更新页面文本
            const translations = {
                'hero-title': isEnglish ? 'Empowering Health with Intelligence<br>Illuminating Hearts with Technology' : '用智慧赋能健康<br>让心灵沐浴科技之光',
                'hero-subtitle': isEnglish ? 'AI Empowerment · Digital Health · Human Care' : 'AI 赋能 · 数字健康 · 人本关怀',
                'hero-description': isEnglish ? 'Ximory is committed to empowering individual health management with AI, creating user-centered digital health solutions' : '心沐智康致力于以AI赋能个体健康管理，打造以用户为中心的数字健康解决方案',
                'assessment-btn': isEnglish ? 'Free Health Assessment' : '免费健康评估',
                'learn-more-btn': isEnglish ? 'Learn More' : '了解更多'
            };

            Object.keys(translations).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = translations[id];
                }
            });
        }

        // 健康评估相关函数
        function nextStep() {
            if (currentStep === 1) {
                // 验证第一步数据
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender').value;
                const height = document.getElementById('height').value;
                const weight = document.getElementById('weight').value;

                if (!age || !gender || !height || !weight) {
                    alert('请填写完整的基本信息');
                    return;
                }

                // 保存数据
                healthData.age = parseInt(age);
                healthData.gender = gender;
                healthData.height = parseFloat(height);
                healthData.weight = parseFloat(weight);
                healthData.bmi = calculateBMI(height, weight);

                currentStep = 2;
                updateStepDisplay();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // 隐藏所有步骤
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step-${i}`);
                if (step) {
                    step.style.display = 'none';
                }
            }

            // 显示当前步骤
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            if (currentStepElement) {
                currentStepElement.style.display = 'block';
            }

            // 更新进度条
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            if (progressBar) {
                const progress = (currentStep / 3) * 100;
                progressBar.style.width = progress + '%';
            }
            
            if (progressText) {
                progressText.textContent = `第${currentStep}步，共3步`;
            }
        }

        function submitAssessment() {
            // 验证第二步数据
            const exercise = document.getElementById('exercise').value;
            const sleep = document.getElementById('sleep').value;
            const smoking = document.getElementById('smoking').value;
            const alcohol = document.getElementById('alcohol').value;

            if (!exercise || !sleep || !smoking || !alcohol) {
                alert('请填写完整的生活习惯信息');
                return;
            }

            // 保存数据
            healthData.exercise = exercise;
            healthData.sleep = sleep;
            healthData.smoking = smoking;
            healthData.alcohol = alcohol;

            // 计算健康评分
            const results = calculateHealthScore(healthData);
            
            // 保存评估记录
            const assessmentData = {
                basicInfo: {
                    age: healthData.age,
                    gender: healthData.gender,
                    height: healthData.height,
                    weight: healthData.weight,
                    bmi: healthData.bmi
                },
                lifestyle: {
                    exercise_frequency: healthData.exercise,
                    sleep_quality: healthData.sleep,
                    smoking: healthData.smoking,
                    alcohol: healthData.alcohol
                },
                results: results
            };
            
            healthDataManager.addAssessment(assessmentData);

            // 显示结果
            displayResults(results);
            
            currentStep = 3;
            updateStepDisplay();
        }

        function calculateBMI(height, weight) {
            const heightInMeters = height / 100;
            return Math.round((weight / (heightInMeters * heightInMeters)) * 10) / 10;
        }

        function calculateHealthScore(data) {
            let score = 100;
            let riskFactors = [];
            let recommendations = [];
            
            // BMI评估
            const bmi = data.bmi;
            if (bmi < 18.5) {
                score -= 15;
                riskFactors.push('体重偏轻');
                recommendations.push('建议增加营养摄入，适当增重');
            } else if (bmi >= 25) {
                score -= 20;
                riskFactors.push('体重超标');
                recommendations.push('建议控制饮食，增加运动量');
            } else if (bmi >= 24) {
                score -= 10;
                riskFactors.push('体重偏高');
                recommendations.push('注意饮食平衡，保持运动');
            }
            
            // 年龄因素
            if (data.age > 50) {
                score -= 5;
                recommendations.push('建议定期体检，关注慢性疾病预防');
            } else if (data.age > 40) {
                score -= 3;
                recommendations.push('注意心血管健康，保持良好生活习惯');
            }
            
            // 运动频率
            switch (data.exercise) {
                case 'never':
                    score -= 25;
                    riskFactors.push('缺乏运动');
                    recommendations.push('建议每周至少进行150分钟中等强度运动');
                    break;
                case 'rarely':
                    score -= 15;
                    riskFactors.push('运动不足');
                    recommendations.push('逐步增加运动频率，培养运动习惯');
                    break;
                case 'sometimes':
                    score -= 5;
                    recommendations.push('保持现有运动习惯，可适当增加强度');
                    break;
                case 'regularly':
                    recommendations.push('运动习惯良好，继续保持');
                    break;
            }
            
            // 睡眠质量
            switch (data.sleep) {
                case 'poor':
                    score -= 20;
                    riskFactors.push('睡眠质量差');
                    recommendations.push('改善睡眠环境，建立规律作息');
                    break;
                case 'fair':
                    score -= 10;
                    recommendations.push('注意睡眠质量，保证充足睡眠');
                    break;
                case 'good':
                    break;
                case 'excellent':
                    score += 5;
                    break;
            }
            
            // 吸烟
            if (data.smoking === 'yes') {
                score -= 30;
                riskFactors.push('吸烟');
                recommendations.push('强烈建议戒烟，寻求专业戒烟帮助');
            }
            
            // 饮酒
            switch (data.alcohol) {
                case 'daily':
                    score -= 20;
                    riskFactors.push('过量饮酒');
                    recommendations.push('减少饮酒量，避免每日饮酒');
                    break;
                case 'weekly':
                    score -= 10;
                    recommendations.push('适量饮酒，注意控制频率');
                    break;
                case 'occasionally':
                    score -= 2;
                    break;
                case 'never':
                    break;
            }
            
            // 确保分数在合理范围内
            score = Math.max(0, Math.min(100, Math.round(score)));
            
            // 确定风险等级
            let riskLevel;
            if (score >= 80) {
                riskLevel = 'excellent';
            } else if (score >= 60) {
                riskLevel = 'good';
            } else if (score >= 40) {
                riskLevel = 'fair';
            } else {
                riskLevel = 'poor';
            }
            
            // 添加通用建议
            recommendations.push('保持均衡饮食，多吃蔬菜水果');
            recommendations.push('定期体检，及时发现健康问题');
            recommendations.push('保持积极心态，管理生活压力');
            
            return {
                health_score: score,
                risk_level: riskLevel,
                risk_factors: riskFactors,
                recommendations: recommendations.slice(0, 5),
                bmi: bmi
            };
        }

        function displayResults(results) {
            // 更新评分
            const scoreElement = document.getElementById('health-score');
            if (scoreElement) {
                scoreElement.textContent = results.health_score;
            }

            // 更新评分条
            const scoreBar = document.getElementById('score-bar');
            if (scoreBar) {
                scoreBar.style.width = results.health_score + '%';
                scoreBar.className = `h-4 rounded-full score-bar ${getScoreBarColor(results.health_score)}`;
            }

            // 更新风险等级
            const scoreLevelElement = document.getElementById('score-level');
            if (scoreLevelElement) {
                scoreLevelElement.textContent = getRiskLevelText(results.risk_level);
                scoreLevelElement.className = `text-2xl font-semibold mb-4 ${getScoreTextColor(results.health_score)}`;
            }

            // 更新建议
            const recommendationsElement = document.getElementById('recommendations');
            if (recommendationsElement) {
                recommendationsElement.innerHTML = results.recommendations.map(rec => 
                    `<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-blue-800">${rec}</p>
                    </div>`
                ).join('');
            }
        }

        function getScoreBarColor(score) {
            if (score >= 80) return 'bg-gradient-to-r from-green-400 to-green-600';
            if (score >= 60) return 'bg-gradient-to-r from-blue-400 to-blue-600';
            if (score >= 40) return 'bg-gradient-to-r from-yellow-400 to-yellow-600';
            return 'bg-gradient-to-r from-red-400 to-red-600';
        }

        function getScoreTextColor(score) {
            if (score >= 80) return 'text-green-600';
            if (score >= 60) return 'text-blue-600';
            if (score >= 40) return 'text-yellow-600';
            return 'text-red-600';
        }

        function getRiskLevelText(level) {
            switch (level) {
                case 'excellent': return '健康状况优秀';
                case 'good': return '健康状况良好';
                case 'fair': return '健康状况一般';
                case 'poor': return '需要改善健康状况';
                default: return '健康状况未知';
            }
        }

        function resetAssessment() {
            currentStep = 1;
            healthData = {};
            
            // 清空表单
            const inputs = document.querySelectorAll('#health-assessment input, #health-assessment select');
            inputs.forEach(input => {
                input.value = '';
            });
            
            updateStepDisplay();
        }

        // 数据仪表板相关函数
        function refreshDashboard() {
            const stats = healthDataManager.getStatistics();
            const recentAssessments = healthDataManager.getRecentAssessments(10);

            // 更新统计卡片
            updateDashboardStats(stats);
            
            // 更新图表
            updateDashboardCharts(stats);
            
            // 更新表格
            updateDashboardTable(recentAssessments);
        }

        function updateDashboardStats(stats) {
            document.getElementById('total-assessments').textContent = stats.total_assessments;
            document.getElementById('average-score').textContent = stats.average_score;
            document.getElementById('today-assessments').textContent = stats.today_stats.total_assessments;
            
            const excellentCount = stats.today_stats.score_distribution.excellent;
            const total = stats.total_assessments;
            const excellentPercentage = total > 0 ? Math.round((excellentCount / total) * 100) : 0;
            document.getElementById('excellent-percentage').textContent = excellentPercentage + '%';
        }

        function updateDashboardCharts(stats) {
            updateScoreChart(stats.today_stats.score_distribution);
            updateAgeChart(stats.today_stats.age_distribution);
        }

        function updateScoreChart(distribution) {
            const ctx = document.getElementById('score-chart');
            if (!ctx) return;

            if (window.scoreChart) {
                window.scoreChart.destroy();
            }

            window.scoreChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['优秀 (80+)', '良好 (60-79)', '一般 (40-59)', '需改善 (<40)'],
                    datasets: [{
                        data: [
                            distribution.excellent || 0,
                            distribution.good || 0,
                            distribution.fair || 0,
                            distribution.poor || 0
                        ],
                        backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#EF4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateAgeChart(distribution) {
            const ctx = document.getElementById('age-chart');
            if (!ctx) return;

            if (window.ageChart) {
                window.ageChart.destroy();
            }

            window.ageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['30岁以下', '30-50岁', '50岁以上'],
                    datasets: [{
                        label: '人数',
                        data: [
                            distribution.under_30 || 0,
                            distribution.age_30_50 || 0,
                            distribution.over_50 || 0
                        ],
                        backgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateDashboardTable(assessments) {
            const tbody = document.getElementById('assessment-table');
            if (!tbody) return;

            tbody.innerHTML = '';
            
            if (!assessments || assessments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">暂无评估记录</td></tr>';
                return;
            }
            
            assessments.forEach(assessment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${new Date(assessment.created_at).toLocaleString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${assessment.basic_info.age}岁
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${assessment.basic_info.gender === 'male' ? '男' : '女'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${assessment.basic_info.bmi}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${getScoreColor(assessment.results.health_score)}">
                            ${assessment.results.health_score}分
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${getRiskColor(assessment.results.risk_level)}">
                            ${getRiskText(assessment.results.risk_level)}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getScoreColor(score) {
            if (score >= 80) return 'bg-green-100 text-green-800';
            if (score >= 60) return 'bg-blue-100 text-blue-800';
            if (score >= 40) return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        }

        function getRiskColor(level) {
            switch (level) {
                case 'excellent': return 'bg-green-100 text-green-800';
                case 'good': return 'bg-blue-100 text-blue-800';
                case 'fair': return 'bg-yellow-100 text-yellow-800';
                case 'poor': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getRiskText(level) {
            switch (level) {
                case 'excellent': return '优秀';
                case 'good': return '良好';
                case 'fair': return '一般';
                case 'poor': return '需改善';
                default: return '未知';
            }
        }
    </script>
</body>
</html>

